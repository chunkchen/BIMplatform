<!DOCTYPE html>
<html lang="en" ng-app="myApp">
 <head> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" /> 
  <meta name="screen-orientation" content="portrait" /> 
  <meta name="x5-orientation" content="portrait" /> 
  <meta name="full-screen" content="yes" /> 
  <meta name="x5-fullscreen" content="true" /> 
  <meta name="browsermode" content="application" /> 
  <meta name="x5-page-mode" content="app" /> 
  <title>东链博BIM应用Server</title> 
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />  
  <link rel="stylesheet" href="public/css/format.css" type="text/css" /> 
  <link rel="stylesheet" href="public/css/bim.css" type="text/css" /> 
  <link rel="stylesheet" href="public/css/guest.css" type="text/css" /> 
  <link rel="stylesheet" href="public/css/index.css" type="text/css" /> 
  <style>
		html,body,#mySceneCanvas{width:100%;height:100%;overflow:hidden}
	</style> 
 </head> 
 <body>
 <div id="luopanBox" class="ui-draggable">
    <div class="luopanBar">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="luopanSvg" width="240" height="240">
            <image x="28" y="28" width="184" height="184" id="luopanSvgImg1" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="./public/images/luopan_bg.png"></image>
    </div>
</div>
  <canvas id="mySceneCanvas" width="100%" height="100%"></canvas>  
  <header class="app-header navbar"> 
   <a class="navbar-brand" href="#"></a> 
   <a class="navbar-brand-txt" href="#">东链博BIM应用Server</a>
  </header> 
  <div class="aside-menu-box"> 
   <ul class="aside-box"> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 文件 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 场景树 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 类型 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 属性 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 搜索 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 标注 </p> </a> </li> 
    <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 楼层 </p> </a> </li> 
    <!-- <li class="li"> <a class="font" data-section=""> <i class="iconfont"></i> <i class="iconfont1"></i> <p> 漫游控制 </p> </a> </li> --> 
   </ul> 
  </div> 
<div class="nav-slide">
	<div class="nav-iconback"></div>
	<div class="nav-slide-o">
		<div ng-controller="fileCtrl">
			<div ng-include="'./treeTemp/file.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
		<div ng-controller="treeCtrl">
			<div ng-include="'./treeTemp/treeView.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
	<div ng-controller="typeCtrl">
			<div ng-include="'./treeTemp/typeView.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
		<div ng-controller="pTableCtrl" id="pTable">
			<div ng-include="'./treeTemp/pTable.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
		<div ng-controller="searchCtrl">
			<div ng-include="'./treeTemp/search.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
	<div ng-controller="markCtrl">
			<div ng-include="'./treeTemp/mark.html'"></div>
		</div>
	</div>
	<div class="nav-slide-o">
		<div ng-controller="floorCtrl" id="pTable">
			<div ng-include="'./treeTemp/floor.html'"></div>
		</div>
	</div>
<!--<div class="nav-slide-o"></div> -->
</div>
<script type="text/javascript" src="public/js/jquery/2.1.4/jquery-2.1.4.min.js"></script>  
<script type="text/javascript" src="public/js/progress.js"></script> 
<script type="text/javascript" src="public/js/websoket.js"></script> 
<script src="public/js/scenejs/scenejs.js"></script> 
<script src="public/js/scenejs/plugins/node/geometry/base64util.js"></script> 
<script src="public/js/ifc/Constants.js"></script> 
<script src="public/js/angularjs/1.4.4/angular.min.js"></script>
<script src="public/js/angularjs/1.4.4/angular-resource.min.js"></script>
<script src="public/js/angularjs/1.4.4/angular-route.min.js"></script> 
<script src="public/js/app/sceneTree.js"></script>
<script src="public/js/app/menu.js"></script>
<script src="public/js/app/renderBim.js"></script>
<script src="public/js/html5validate.js" type="text/javascript"></script>
<script src="public/js/dlbSvg.js" type="text/javascript"></script>
<script>
function GetQueryString(name){
   var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
   var r = window.location.search.substr(1).match(reg);
   if (r!=null) return unescape(r[2]); return null;
}
var string = GetQueryString("rid")||4;
var websocket = new WebsocketBim();
window.hisPick = {}; //记录点过的东西
websocket.init({
	urlPath:"ws/geometry?rid="+string,
	onopen:function(msg){
		window.progress = $.progress();
	},
	onmessage:function(data){
		if(data.progress){
			progress.update(data);
			if(data.progress == data.max){
				progress.hide();
			}
		}else if(data.zoom){
			window.maxZoom = data.zoom;
		}else{
			progress.hide();
			if(!window.scene){
				createScene(data);
				showView(data);
			}else{
				showView(data);
			}
		}
	},
	onclose:function(){
		//bindEvent();
		websocket = null;
	}
});
//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
window.onbeforeunload = function () {
	if(websocket){
		websocket.send('close');	
	}
	
}
</script>
 </body>
</html>
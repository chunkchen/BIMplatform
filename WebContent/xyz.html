<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>计算</title>

    <script src="js/jquery.min.js"></script>

</head>
<body>
    <div>计算瓦片坐标
        <div>
            <input id="lon" type="text" placeholder="请输入经度"/>
        </div>
        <div>
            <input id="lat" type="text" placeholder="请输入纬度"/>
        </div>
        <div>
            <input id="layer_num" type="text" placeholder="请输入层级"/>
        </div>
        <div>
            <button id="cal" onclick="calculateLonlat()">开始计算</button>
        </div>
        <div class="showPannel" id="showPannel">
            显示结果
        </div>
    </div>
    <div>计算经纬度坐标
        <div>
            <input id="x" type="text" placeholder="请输入x值"/>
        </div>
        <div>
            <input id="y" type="text" placeholder="请输入y值"/>
        </div>
        <div>
            <input id="layer_num_1" type="text" placeholder="请输入层级"/>
        </div>
        <div>
            <button id="cal_1" onclick="calculateXY()">开始计算</button>
        </div>
        <div class="showPannel" id="showPannel_1">
            显示结果
        </div>
    </div>
    <div>
        <input id = "smid" type = "text" placeholder= "输入smid查询数据"/>
        <button id = "query" onclick="queryData()">开始查询</button>
        <div class="showPannel" id="showPannel_2">
           	 显示结果
        </div>
    </div>

    <script>
    
    
        function calculateLonlat() {

            var lon = $('#lon').val();
            var lat = $('#lat').val();
            var z = $('#layer_num').val();

            if(lon == "") {
                showMsg("请输入正确经度！", 0);
                return;
            } else if(lat == "") {
                showMsg("请输入正确纬度！", 0);
                return;
            } else if(z == "") {
                showMsg("请输入正确层级！", 0);
                return;
            } else if (lon > 180 || lon < -180) {
                showMsg("经度超出范围！", 0);
                return;
            } else if (lat >= 90 || lat <= -90) {
                showMsg("纬度超出范围！", 0);
                return;
            }

            var x = Math.floor(Math.pow(2, z-1) * (lon / 180 + 1));
            var rad = Math.PI * lat / 180;
            var y = Math.ceil(Math.pow(2, z-1) * (1 - Math.log( Math.tan(rad) + 1 / Math.cos(rad) ) / Math.PI));

            showMsg("x = "+x+" y = "+y, 0);
        }

        function calculateXY() {

            var x = $('#x').val();
            var y = $('#y').val();
            var z = $('#layer_num_1').val();

            if(x == "") {
                showMsg("请输入正确经度！", 1);
                return;
            } else if(y == "") {
                showMsg("请输入正确纬度！", 1);
                return;
            } else if(z == "") {
                showMsg("请输入正确层级！", 1);
                return;
            }

            var total = Math.pow(2, z);
            var lon = x / total * 360 - 180;
            var lat = Math.atan(Math.sinh(Math.PI * (1 - 2 * y / total))) * 180 / Math.PI;

            showMsg("lon = "+lon+" lat = "+lat, 1);
        }

        function showMsg(msg, index){
            if (index == 0) {
                $('#showPannel').text(msg);
            } else if (index == 1) {
                $('#showPannel_1').text(msg);
            } else {
            	$('#showPannel_2').text(msg);
            }

        }
        
        function queryData() {
//             var smid = $('#smid').val();
            var params = {};
//             params.smid = smid;
            
            $.ajax ({
                async:false,
                type: "POST",
                url: "queryAllIfcModel.do",
                data: params,
               	dataType:"json",
                success:function(data) {
                	var str = JSON.stringify(data);
                	showMsg(str, 2);
                },
                error:function(data){
                    alert("error");
                }
            });
            
            alert(1);
            
        }

    </script>
</body>
</html>